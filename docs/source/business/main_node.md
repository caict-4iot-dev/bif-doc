骨干节点接入
=========================

## 前言

​文档目的：指导骨干节点/骨干链接入，包含接入流程、接入内容和开发规范。接入方式**先通过星火·链网超级节点测试网络平台进行测试验证**，接入测试成功后再接入超级节点正式系统。

**测试系统** 超级节点测试网络平台地址：http://test-boss.bitfactory.cn/

**生产系统** 超级节点区块链网络平台地址：https://boss.bitfactory.cn/

## 通用说明

### 名词解释

**API_key** 开发者的身份ID，可用于获取骨干节点的调用凭证（access_token），然后通过接口调用凭证再来访问开放平台API。

**API_secret** 开发者身份ID对应的密钥，配合API_key使用能够获取接口调用凭证，同时为了安全起见这个密钥需要妥善保管。

**accessToken** 所有API接口的调用凭证，通过API_key和API_secret调用相关接口获得，具有时效性，有效时间为2小时， 过期后需要重新获取否则会调用接口失败，因为凭证获取的接口有调用次数限制，所以建议妥善保存并管理。

**AC号** 自治共识域为边界的跨链互通能力（ACSN，Autonomous Consensus System Number），简称共识域号，即AC号，AC号是由四位小写字母和数字组成，代表各区块链在星火·链网中唯一合法身份，是星火·链网体系中区分不同区块链共识区域的代号，用于区块链身份识别及全网寻址功能。

**BID** 区块链上标记某个对象唯一分布式标识。

**publicKey、privateKey** 公钥和私钥是建立在区块链网络上不可缺少的组成部分，链上发起交易都是需要私钥来签名的。私钥可以恢复公钥，但是，仅使用公钥是不可能找到私钥的。

**blob** 星火·链网上交易结构序列化后的十六进制格式，用于执行上链操作。

**backboneNodeBid** 骨干节点BID，成为骨干节点时 可以登录星火链网 业务管理平台查看骨干节点BID。

**gatewayAddress** 网关节点账户bid，骨干节点为下属子链上报信息时，需要使用这个账户发起交易。

**跨链合约** 部署跨链合约后可支持主链积分转移、子链积分转移、数据跨链、智能合约跨链互操作功能。

**网关节点地址** 子链将数据通过链网关账户锚定到国家主链。

**服务商** 是指经有效申请并通过星火市场验证，入驻星火·链网星火市场，并通过星火市场向用户进行在线销售服务的企业。

**应用服务** 是指服务商在星火市场发布的应用类服务，用户购买后可以通过已购服务列表中授权BID后直接访问服务商提供的外部系统或平台。

**开发服务** 是指服务商在星火市场发布的开发类服务，如提供多维度的区块链软件能力、行业解决方案，为企业实现一站式区块链业务赋能。开发服务目前可支持API类和交付类两大分类。

**服务调用剩余时长** 是指用户在星火市场上购买设置按时计费的API类开发服务，在已购服务详情中可以查看该服务的剩余时长。

**服务调用剩余次数** 是指用户在星火市场上购买设置按次计费的API类开发服务，在已购服务详情中可以查看该服务的剩余次数。


## 接入流程

​骨干节点接入主链分为**线上注册申请**和**线下开发**两部分内容，具体流程如下图所示，蓝色标记部分需要骨干节点登录超级节点业务系统进行操作 ：

​![img](../images/main_node_1.png)        

## 接入内容

### 接入内容概述

骨干节点需根据本文档及[《BID协议》](https://bid-resolution-protocol-doc.readthedocs.io/zh_CN/v1.9.4/)要求开发接入主链，将骨干节点及其子链信息同步至主链锚定，实现与主链的互联互通，并且在实际业务中应用BID。为实现以上目标，至少需要接入以下内容：

1. 注册申请：包含企业账号注册、获取数字身份、可信认证申请、骨干节点申请、API调用权限申请。该接入内容，需要登录到超级节点业务系统中进行操作。

2. 底层链锚定：包含链基础信息同步、链状态信息同步、链节点信息同步、链节点运行状态同步、链的区块信息同步、交易信息同步、合约信息同步。

3. 底层链业务接入：链应用服务信息同步

4. BID标识应用于实际业务：

- 标识注册、标识解析。
- 将BID标识应用于当前的业务中。由于不同骨干节点/骨干链上业务不同，需和信通院详细沟通，可能需要对骨干链上现有业务进行改造。

**说明**

- **以上4部分内容全部接入后即对接成功，测试环境对接成功后才可接入生产环境。**



### 注册申请

#### 注册企业账号

第一步：访问星火·链网业务系统 注册**企业账户**。（用户想要接入哪个超级节点，就登录该超级节点系统执行申请操作）


第二步：登录后，进入账户中心 获取数字身份

​![img](../images/main_node_4.png)        

第三步：完成企业可信认证申请，申请完成后，等待所属超级节点审核企业可信认证，审核通过后，才能进行下一步申请骨干节点。

说明：测试期间，授权书等资料不需要上传真实文件。

​![img](../images/main_node_5.png)        
​
完成可信认证后，可查看证书：
​

#### 4.2.2 申请骨干节点

准备工作：使用BID-SDK-JAVA线下生成一个网关账户地址（公钥私钥也要保存好），为下一步申请成为骨干节点时配置接入网关地址时使用（可以生成多个）

第一步：申请骨干节点，登录星火·链平台选择业务管理平台，节点管理--节点申请--申请骨干节点； 申请完成后，等待所属超级节点审核；审核通过后才能进行下一步操作。（准备工作中生成的网关地址写到服务器信息的“数据网关BID列表中”）

说明：

- AC号：可自定义，最终以超级节点审核结果为准（超级节点审核时可修改AC号）
- 解析服务网络地址：子链解析服务网络地址（子链开发bid注册解析服务时用到）
- 链架构类型：如链架构类型中，没有子链的链结构类型，可联系信通院同事进行添加


第二步：导出骨干节点账户（地址、私钥）为后续骨干节点向主链发交易时使用

超级节点审核完成后，即生成骨干节点账户，骨干节点相关业务以骨干节点身份开展。

#### 4.2.3 申请API调用权限

申请成为骨干节点后，需要申请API调用权限才可调用API服务。

第一步：申请骨干节点API_key和API_secret，在业务管理平台-开发者管理模块中进行APIKey申请，

​                 ![img](../images/main_node_12.png)        

第二步：申请完成后，等待所属超级节点审核，审核完成后 可以在 APIKey管理里面查询开发者信息。

​                 ![img](../images/main_node_13.png)

### 4.3 底层链锚定

#### 4.3.1 [链基础信息同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id2)

#### 4.3.2 [链个性化信息同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id3)

#### 4.3.3 [链状态信息同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id29)

#### 4.4.4 [链节点信息同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id31)

#### 4.4.5 [链节点运行状态同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id34)

#### 4.4.6 [链的区块信息同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id35)

#### 4.4.7 [交易信息同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id38)

#### 4.4.8 [合约信息同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id39)

#### 4.4.9 [链智能合约调用信息同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id42)

#### 4.4.10 [链智能合约部署信息同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id43)

#### 4.4.11 [未打包的交易数同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id44)

#### 4.4.12 [底层链节点故障日志同步](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id45)

#### 4.4.13 [获取区域信息](https://bif-open-api-doc.readthedocs.io/zh_CN/latest/docs/API%E6%8E%A5%E5%8F%A3/4-%E5%BA%95%E5%B1%82%E9%93%BE%E9%94%9A%E5%AE%9A.html#id46)
