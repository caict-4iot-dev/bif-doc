# 星火链开发基础

做星火链应用开发前, 需要了解下星火链的帐号, 交易和费用等基础机制.

## 帐号

星火链帐号的实质为通过非对称加密技术保护的一对公私钥, 每个星火链帐号都会有以下几个属性

1. address 

    账户地址, 实质为公钥的编码转化结果, 只有拥有私钥的用户才能使用对应地址发出交易.

1. nonce

    每个账户从0开始的计数, 代表该账户发起的交易数量, 同时用来防止签名重放攻击. 当账号执行一笔交易入链后，无论交易成功还是失败, 账号的nonce就会加1.
    
    当使用账号发起交易时，需要指定该交易nonce，其值必须比当前账号的nonce大1, 当一个账号被新建时，它的nonce为0.

1. contract

    标明一个帐号是否是智能合约帐号.

1. balance

    账户余额, 注意:每个账户至少要保留0.1XHT余额.

## 交易

星火链上的交易包含的主要元素如下:

1. source

    交易发出地址, 由该地址来支付本次交易耗费的星火令.

1. nonce

    交易序号, 同一个source下的所有交易必须具有唯一的nonce序号, 并且交易只能按照nonce从小到大按序入链, 中间不能有空.

1. fee_limit

    该交易的费用上限, 防止因为不可预知原因或者bug,导致交易耗费过多超出预期.

1. gas_price

    交易的gas价格, 详细参见下节.

## 交易耗费计算和检查

星火链上的所有交易都需要耗费XHT, 耗费的计算公式为gas * gas_price.

1. gas

    gas用来表示单个交易的计算成本, 对于javascript合约, 每种交易类型的gas耗费固定, 对于solidity合约, 交易gas耗费是实际执行的各个op(操作码)的gas耗费之和.

2. gas_price

    gas_price指用户愿意为每单位gas支付的XHT数量, 由用户自己在发出交易时指定.

星火链上每个区块的交易打包时, 会根据gas_price价格排序, gas_price越高的交易会排在前面优先执行. 同时每笔交易在打包前, 会检查下账户费用是否满足以下条件

1. 账户balance - 账户最低reserve_balance > fee_limit

2. 账户balance - 账户最低reserve_balance > gas * gas_price
    
    注意: 
        
        对于javascript合约, 系统会提前根据交易类型计算需要gas, 如果账户余额不足, 交易提交失败不予入链; 
        
        对于EVM合约, 会实时消耗XHT到余额不足时交易失败, 耗费的fee不会返还;
    
